n=q[0],k=q[1]}else k=n=g;var t=W(c,b);"target"!==n&&"both"!==n||(d<t[1]&&"top"===r.top&&(d+=l,r.top="bottom"),d+h>t[3]&&"bottom"===r.top&&(d-=l,r.top="top")),"together"===n&&("top"===r.top&&("bottom"===s.top&&d<t[1]?(d+=l,r.top="bottom",d+=h,s.top="top"):"top"===s.top&&d+h>t[3]&&d-(h-l)>=t[1]&&(d-=h-l,r.top="bottom",s.top="bottom")),"bottom"===r.top&&("top"===s.top&&d+h>t[3]?(d-=l,r.top="top",d-=h,s.top="bottom"):"bottom"===s.top&&d<t[1]&&d+(2*h-l)<=t[3]&&(d+=h-l,r.top="top",s.top="top")),"middle"===r.top&&(d+h>t[3]&&"top"===s.top?(d-=h,s.top="bottom"):d<t[1]&&"bottom"===s.top&&(d+=h,s.top="top"))),"target"!==k&&"both"!==k||(e<t[0]&&"left"===r.left&&(e+=m,r.left="right"),e+i>t[2]&&"right"===r.left&&(e-=m,r.left="left")),"together"===k&&(e<t[0]&&"left"===r.left?"right"===s.left?(e+=m,r.left="right",e+=i,s.left="left"):"left"===s.left&&(e+=m,r.left="right",e-=i,s.left="right"):e+i>t[2]&&"right"===r.left?"left"===s.left?(e-=m,r.left="left",e-=i,s.left="right"):"right"===s.left&&(e-=m,r.left="left",e+=i,s.left="left"):"center"===r.left&&(e+i>t[2]&&"left"===s.left?(e-=i,s.left="right"):e<t[0]&&"right"===s.left&&(e+=i,s.left="left"))),"element"!==n&&"both"!==n||(d<t[1]&&"bottom"===s.top&&(d+=h,s.top="top"),d+h>t[3]&&"top"===s.top&&(d-=h,s.top="bottom")),"element"!==k&&"both"!==k||(e<t[0]&&("right"===s.left?(e+=i,s.left="left"):"center"===s.left&&(e+=i/2,s.left="left")),e+i>t[2]&&("left"===s.left?(e-=i,s.left="right"):"center"===s.left&&(e-=i/2,s.left="right"))),"string"==typeof j?j=j.split(",").map(function(a){return a.trim()}):j===!0&&(j=["top","left","right","bottom"]),j=j||[];var u=[],v=[];d<t[1]&&(j.indexOf("top")>=0?(d=t[1],u.push("top")):v.push("top")),d+h>t[3]&&(j.indexOf("bottom")>=0?(d=t[3]-h,u.push("bottom")):v.push("bottom")),e<t[0]&&(j.indexOf("left")>=0?(e=t[0],u.push("left")):v.push("left")),e+i>t[2]&&(j.indexOf("right")>=0?(e=t[2]-i,u.push("right")):v.push("right")),u.length&&!function(){var a=void 0;a="undefined"!=typeof c.options.pinnedClass?c.options.pinnedClass:c.getClass("pinned"),p.push(a),u.forEach(function(b){p.push(a+"-"+b)})}(),v.length&&!function(){var a=void 0;a="undefined"!=typeof c.options.outOfBoundsClass?c.options.outOfBoundsClass:c.getClass("out-of-bounds"),p.push(a),v.forEach(function(b){p.push(a+"-"+b)})}(),(u.indexOf("left")>=0||u.indexOf("right")>=0)&&(s.left=r.left=!1),(u.indexOf("top")>=0||u.indexOf("bottom")>=0)&&(s.top=r.top=!1),r.top===f.top&&r.left===f.left&&s.top===c.attachment.top&&s.left===c.attachment.left||(c.updateAttachClasses(s,r),c.trigger("update",{attachment:s,targetAttachment:r}))}),y(function(){c.options.addTargetClasses!==!1&&w(c.target,p,o),w(c.element,p,o)}),{top:d,left:e}}});var E=f.Utils,n=E.getBounds,w=E.updateClasses,y=E.defer;f.modules.push({position:function(b){var c=this,d=b.top,e=b.left,f=this.cache("element-bounds",function(){return n(c.element)}),g=f.height,h=f.width,i=this.getTargetBounds(),j=d+g,k=e+h,l=[];d<=i.bottom&&j>=i.top&&["left","right"].forEach(function(a){var b=i[a];b!==e&&b!==k||l.push(a)}),e<=i.right&&k>=i.left&&["top","bottom"].forEach(function(a){var b=i[a];b!==d&&b!==j||l.push(a)});var m=[],o=[],p=["left","top","right","bottom"];return m.push(this.getClass("abutted")),p.forEach(function(a){m.push(c.getClass("abutted")+"-"+a)}),l.length&&o.push(this.getClass("abutted")),l.forEach(function(a){o.push(c.getClass("abutted")+"-"+a)}),y(function(){c.options.addTargetClasses!==!1&&w(c.target,o,m),w(c.element,o,m)}),!0}});var B=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var h,g=a[Symbol.iterator]();!(d=(h=g.next()).done)&&(c.push(h.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&g.return&&g.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return f.modules.push({position:function(b){var c=b.top,d=b.left;if(this.options.shift){var e=this.options.shift;"function"==typeof this.options.shift&&(e=this.options.shift.call(this,{top:c,left:d}));var f=void 0,g=void 0;if("string"==typeof e){e=e.split(" "),e[1]=e[1]||e[0];var h=e,i=B(h,2);f=i[0],g=i[1],f=parseFloat(f,10),g=parseFloat(g,10)}else f=e.top,g=e.left;return c+=f,d+=g,{top:c,left:d}}}}),U}),function(a){function k(a){return Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)}function l(a){b=a,b.provinces.sort(function(a,b){return a.name>b.name}),m(),o(),v("ZA")}function m(){var a=b.provinces,c=[],d=[];a.forEach(function(a,b){var d=a.code,f="ZA"===d;if(e[d]=b,c.push(n(f?"National":a.name,d,f)),f){var g=a[0],h=c[0];a[0]=a,a[b]=g,c[0]=c[c.length-1],c[c.length-1]=h}}),d.push({target:"prvLinks",change:c,type:"list"}),u(d)}function n(a,b,c){var d=$('<a class="dropdown-item nav-item" data-code="'+b+'">'+a+"</a>");return c&&d.addClass("active"),d}function o(a){var b=$.merge(h.$prvBtns,h.$prvLinks);b.on("click",function(a){var b=$(a.target),c=b.attr("data-code");$(".nav-item").removeClass("active"),$('.nav-item[data-code="'+c+'"]').addClass("active"),c?v(c):console.log("Province data does not exist for province with code "+c)}),a&&a()}function q(a){var b=a.code,d=a.name,e=d.split("("),f=e[0]?e[0]:"",g=e[1]?"("+e[1]:"",h=$('<div class="med-row '+a.status+'"></div>'),i=$('<div class="med-info" id="'+b+'-heading"></div>'),j=$('<div class="row-toggle row" aria-controls="info-'+b+'" data-toggle="collapse" data-parent="#stock-table" aria-expanded="false" data-target="#info-'+b+'"></div>'),k=$('<div id="info-'+b+'" class="panel-collapse collapse" role="tabpanel" aria-labelledby="'+b+'-heading"><div class="inner">'+c.MEDICINES[b]+"</div></div>"),l=$('<div class="med-name col-xs-6 col-sm-7"><span class="plus"><i class="fa fa-plus" aria-hidden="true"></i></span>'+f+"</div>"),m=$('<span class="med-dosage">'+g+"</span>"),n=$('<div class="med-avail text-xs-center col-xs-3 col-sm-3"><strong>'+a.avail+"%</strong></div>"),o=$('<div class="med-checks text-xs-center col-xs-3 col-sm-2">'+a.totalChecks+"</div>");return l.append(m),j.append(l,n,o),i.append(j),h.append(i,k),h}function r(){for(var a in h)h[a].empty()}function s(a){var c=a.medicine_instock,d=a.medicine_stockouts,e=b.medicines,f=[];for(var g in e){var h=c[g];if(h){var i={},j=d[g]?d[g]:0,k=h+j,l=(h/k*100).toFixed(0);i.code=g,i.name=e[g],i.totalChecks=k,i.avail=l,i.status=t(l),f.push(i)}}return f.sort(function(a,b){return a.avail-b.avail}),f}function t(a){var b="";return b=a<=50?"critical":a>50&&a<=75?"intermediate":"normal"}function u(a,b){a?(k(a)?a.forEach(function(a){var b=h["$"+a.target],c=a.change,d=a.type?a.type:"set";switch(d){case"set":b.html(c);break;case"append":b.append(c);break;case"list":b.empty().append(c);break;case"dash":b.attr("stroke-dashoffset",c)}}):k(a)||"object"!=typeof a||u([a]),b&&pymChild.sendHeight()):console.log("No keys supplied to view, so DOM remains unchanged.")}function v(a){var f,c=b.provinces[e[a]];if(c){var g=d[a],i=c.stats,j=i.total_clinics,k=[],f=null,l=[],m=i.monthly_availability,n=null,o="",p=null;for(var v in m){var w=m[v],x=new Date(v);x>n&&(n=x,p=w.toFixed(0))}o=n.getFullYear(),g?f=g:(f=s(c.stats),d[a]=f),f.forEach(function(a){k.push(q(a))}),l.push({target:"prvName",change:c.name}),l.push({target:"prvClinics",change:j}),l.push({target:"stockTable",change:k,type:"list"}),l.push({target:"prvAvail",change:p+"%"}),l.push({target:"availDate",change:o}),u(l,!0),h.$prvAvail.addClass(t(p)),h.$medicines=$("#prv-stock-table .med-row")}else console.log("No data for province code "+a),r()}var b=null,c=a.constants;a.pymChild=a.pymChild||new pym.Child({id:"code4sa-embed-stockout"});var d={},e={},f=new Date,g=f;g.setDate(g.getDate()-c.WAITING_PERIOD);var h={};h.$stockTable=$("#prv-stock-table"),h.$infoRow=$("#prv-stock-table .info-row"),h.$totalClinics=$("#clinics-total"),h.$prvBtns=$("#prv-btns"),h.$prvLinks=$("#prv-links"),h.$prvName=$("#prv-name"),h.$prvClinics=$("#prv-clinics"),h.$prvAvail=$("#prv-avail"),h.$availDate=$("#avail-date"),h.$counter=$("#counter"),h.$reports=$("#reports"),fetch(c.URL).then(function(a){return a.ok?a.json().then(function(a){l(a)}):void console.log("Error with response.")});for(var i=c.REPORTS_START;i<=f.getFullYear();i++){var j="Full-year "+i;i==f.getFullYear()&&(j=c.LONG_MONTHS[0]+" - "+c.LONG_MONTHS[g.getMonth()]+" "+i),h.$reports.append('<a class="dropdown-item" href="https://cbm.code4sa.org/stockouts/year/report/?year='+i+'" target="_blank">'+j+"</a>")}}(window),window.constants=window.constants||{},constants.URL="https://cbm.code4sa.org/stockouts/stats/",constants.PRV_IMAGES={EC:"ec.png",FS:"fs.png",GT:"gau.png",KZN:"kzn.png",LIM:"lim.png",MP:"mpu.png",NC:"nc.png",NW:"nw.png",WC:"wc.png"},constants.REPORTS_START=2014,constants.WAITING_PERIOD=28,constants.MONTHS=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],constants.LONG_MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"],constants.MEDICINES={aba:"Abacavir (ABC) is currently recommended as part of first- and second-line antiretroviral therapy (ART) for HIV-positive paediatric patients.",adr:"Adrenaline is used as a treatment for anaphylaxis. Anaphylaxis is an extreme form of an allergic reaction can cause swelling of your mouth and tongue, breathing problems, flushing, collapse and a loss of consciousness.",amosus:"Amoxicillin suspension is used susceptible infections including ear/nose/throat, genetial and unirary tract, skin and skin structures, lower respiratory, acute uncomplicated gonorrhea.",amocap:"Amoxicillin capsules are used susceptible infections including ear/nose/throat, genetial and unirary tract, skin and skin structures, lower respiratory, acute uncomplicated gonorrhea.",azi:"Azithromycin is used to treat many different types of infections caused by bacteria, such as respiratory infections, skin infections, ear infections, and sexually transmitted diseases.",cef:"Azithromycin is used to treat many different types of infections caused by bacteria, such as respiratory infections, skin infections, ear infections, and sexually transmitted diseases.",bec:"Beclomethasone 50 mcg or 100 mcg inhaler indicated as primary maintenance treatment in patients with persistent symptoms of chronic bronchial asthma.",cex:"Ceftriaxone injection is used to treat certain infections caused by bacteria such as gonorrhea (a sexually transmitted disease), pelvic inflammatory disease (infection of the female reproductive organs that may cause infertility), meningitis (infection of the membranes that surround the brain and spinal cord), and infections of the lungs, ears, skin, urinary tract, blood, bones, joints, and abdomen.",dta:"DTaP-IPV-Hib vaccine protects your child against diphtheria, tetanus, pertussis, polio, and Haemophilus influenzae type b, which are serious and sometimes fatal diseases. When you get your child immunized, you help protect others as well.",hyd:" Hydrochlorothiazide treats fluid retention (edema) in people with congestive heart failure, cirrhosis of the liver, or kidney disorders, or edema caused by taking steroids or estrogen. This medication is also used to treat high blood pressure (hypertension).",ins:"Insulin injection is used to control blood sugar in people who have type 1 diabetes (condition in which the body does not make insulin and therefore cannot control the amount of sugar in the blood) or in people who have type 2 diabetes.",iso:"Isoniazid is used with other medications to treat active tuberculosis (TB) infections. It is also used alone to prevent active TB infections in people who may be infected with the bacteria (people with positive TB skin test). Isoniazid is an antibiotic and works by stopping the growth of bacteria.",lam:"Lamivudine 10 mg/mL solution (240 mL)",med:"Medroxyprogesterone is a progestogen, which is a female hormone. It is used to prevent pregnancy. It is a very effective and safe form of contraception.",met:" Metformin is used in patients with type 2 diabetes. Controlling high blood sugar helps prevent kidney damage, blindness, nerve problems, loss of limbs, and sexual function problems.",partab:"Paracetamol is a pain reliever and a fever reducer. The exact mechanism of action of is not known.",parsyr:"Paracetamol is a pain reliever and a fever reducer. The exact mechanism of action of is not known.",rif150:"FDC regimen for treatment of tuberculosis.",rif60:"FDC regimen for treatment of tuberculosis.",sod:"Sodium Chloride used to flush wounds and skin abrasions, as eye drops, for intravenous infusion, rinsing contact lenses, nasal irrigation, and a variety of other purposes.",ten:"Antiretroviral drugs (ARVs) will be used in the first line treatment of HIV-positive patients.",tet:"Tetanus toxoid vaccine is given to provide protection (immunity) against tetanus (lockjaw) in adults and children 7 years or older.",val:"Sodium valproate is used to prevent epileptic seizures in children.",car:"Sodium valproate is used to prevent epileptic seizures in children.",hex:"DTaP-IPV-Hib vaccine protects your child against diphtheria, tetanus, pertussis, polio, and Haemophilus influenzae type b, which are serious and sometimes fatal diseases. When you get your child immunized, you help protect others as well."};
